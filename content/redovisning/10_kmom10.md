---
---
Redovisning kmom10
=========================

<div id="submission_preview" class="paper user_content enhanced">
    <p><strong>Akronym: algn18</strong></p>
<p><strong><a href="https://github.com/AlexanderGranhof/ramverk1-projekt" class="external" target="_blank" rel="noreferrer noopener"><span>Github</span><span aria-hidden="true" class="ui-icon ui-icon-extlink ui-icon-inline" title="Länkar till en externa sida."></span><span class="screenreader-only">&nbsp;(Länkar till en externa sida.)</span></a><br><a href="https://github.com/AlexanderGranhof/ramverk1-projekt/projects/1" class="external" target="_blank" rel="noreferrer noopener"><span>Github Kanban</span><span aria-hidden="true" class="ui-icon ui-icon-extlink ui-icon-inline" title="Länkar till en externa sida."></span><span class="screenreader-only">&nbsp;(Länkar till en externa sida.)</span></a><br><a href="http://www.student.bth.se/~algn18/dbwebb-kurser/ramverk1/me/kmom10/htdocs/" class="external" target="_blank" rel="noreferrer noopener"><span>Projektet</span><span aria-hidden="true" class="ui-icon ui-icon-extlink ui-icon-inline" title="Länkar till en externa sida."></span><span class="screenreader-only">&nbsp;(Länkar till en externa sida.)</span></a><br><a href="https://www.figma.com/file/5EEoyFgHCwzHRo3Nc93jUK/Ramverk1" class="external" target="_blank" rel="noreferrer noopener"><span>Figma design</span><span aria-hidden="true" class="ui-icon ui-icon-extlink ui-icon-inline" title="Länkar till en externa sida."></span><span class="screenreader-only">&nbsp;(Länkar till en externa sida.)</span></a><br><a href="http://www.student.bth.se/~algn18/dbwebb-kurser/ramverk1/me/kmom10/build/coverage/" class="external" target="_blank" rel="noreferrer noopener"><span>Unittest Coverage</span><span aria-hidden="true" class="ui-icon ui-icon-extlink ui-icon-inline" title="Länkar till en externa sida."></span><span class="screenreader-only">&nbsp;(Länkar till en externa sida.)</span></a><br><a href="http://www.student.bth.se/~algn18/dbwebb-kurser/ramverk1/me/redovisa/htdocs/" class="external" target="_blank" rel="noreferrer noopener"><span>Redovisa</span><span aria-hidden="true" class="ui-icon ui-icon-extlink ui-icon-inline" title="Länkar till en externa sida."></span><span class="screenreader-only">&nbsp;(Länkar till en externa sida.)</span></a></strong></p>
<p>&nbsp;</p>
<p><strong>Krav 1, 2, 3: Grunden</strong></p>
<p><span style="font-weight: 400;">När jag började på projektet så var inloggning och databas funktionalitet det första jag började jobba på. Jag valde att använda en enkel vanilla PDO för att koppla mig till en mysql databas. Jag kände mig mer bekväm att skriva råa sql queries istället för att använda databas modulen från anax, då jag har inte använt den så mycket tidigare.</span></p>
<p>&nbsp;</p>
<p><span style="font-weight: 400;">En av de svåraste bitarna för mig var att komma upp med ett tema för projektet. Precis i slutet av projektet valde jag mig för att använda ett mat tema; FoodFlow. Innan jag kom på namnet så hade jag ingen direkt design insperation. Men efter jag hade en idé och namnet så gick jag in på figma.com och började designa en layout för hemsidan. Jag blev faktiskt riktigt nöjd med designen och ser lite trevligare ut än bara gråa färger som jag hade innan.</span></p>
<p>&nbsp;</p>
<p><span style="font-weight: 400;">Gällande generellt för projektet så tänkte jag använda mig av kanban tavla för att hålla koll på vart man låg i projektet. Jag vet från mitt tidigare jobb så använde de projekt tabben i github för att se just vart de ligger någonstans i ett projekt, och jag valde att använda det också för att hålla koll på mig själv. Och det var riktigt användbart då det hjälpte mig att fokusera på de viktigaste sakerna som jag behövde få implementerat.</span></p>
<p>&nbsp;</p>
<p><span style="font-weight: 400;">Den första svåra delen av projektet var att få kommentarerna implementerat och att man kan få rösta på dem. Just att få kommentarerna att ligga som det gör i reddit (som jag använde för referens) där svar är indenterade så var det lite klurigt att förstå hur HTML strukturen kommer ser ut. Jag började med att lägga custom styling på alla kommentarer, som fungerade men det blev väldigt komplicerat och blev inte så bra.</span></p>
<p>&nbsp;</p>
<p><span style="font-weight: 400;">Lösningen var att sätta en </span><i><span style="font-weight: 400;">comment_reply_id</span></i><span style="font-weight: 400;"> column i databasen som hade en foreign key så sig själv, alltså att tabellen comments hade en foreign key referens på comments. Sedan loopade jag igen alla kommentarerna rekursivt och kolla om det fanns några kommentarer som hade ett reply id samma som id på den nuvarande kommentaren. Sedan koppla den som en child och pusha det till en ny array. Till sist gick jag igenom den igen och skapade all HTML rekursivt.</span></p>
<p>&nbsp;</p>
<p><span style="font-weight: 400;">Sedan resten av kraven för denna biten var faktiskt inte så svårt. Det var generella inserts in databasen med rätt post id och user id för att få allt kopplat. Det enda som var lite klurigt var när man skulle radera en kommentar eller en post när den hade kommenterar kopplade till sig. Min lösning var att lägga till en deleted kolumn som fungerade som en soft-delete.</span></p>
<p>&nbsp;</p>
<p><span style="font-weight: 400;">Att få scrutinizer och CircleCI var också relativt enkelt, förutom en liten del där scrutinizer var nere typ 70% av projektet som var riktigt irriterande. Jag fick alltid error 500 när jag skulle se varför den failade att testa projektet. Men som tur var så försvann felet i slutet av projektet.</span></p>
<p>&nbsp;</p>
<p><strong>Krav 4: Frågor (optionell)</strong></p>
<p><span style="font-weight: 400;">Om man fortsätter lite på det man skrev innan kommentarerna så var röstning på kommentarerna den svåra biten. Mitt problem var att jag ville inte uppdatera en kolumn på en kommentar som tex heter score eller något liknande. För problemet kan bli då att man kan tekniskt sett rösta hur många gånger man vill om man fuskar med systemet. Och det fanns ingen historik på vad en användare hade röstat på.</span></p>
<p>&nbsp;</p>
<p><span style="font-weight: 400;">Min lösning var då att skapa en ny tabell som hade koll på alla röster på en kommentar och samt en till tabell för att hålla koll på post röster. Mitt stora problem som jag inte visste hur jag skulle lösa var att jag hade två kolumner i min </span><i><span style="font-weight: 400;">comment_votes</span></i><span style="font-weight: 400;"> tabell som jag ville ha unikt när bara kombinationen av de två redan finns. Om jag satte båda kolumnerna på UNIQUE så räkte det att en person röstade på en post sedan kunde ingen annan rösta. Min lösning på detta problemet var att skapa ett unikt index som tog båda dessa kolumner och satte ihop dem. Som ser ut som: </span><i><span style="font-weight: 400;">UNIQUE INDEX `user_id:post_id` (user_id, post_id)</span></i><span style="font-weight: 400;">. Detta fungerade helt perfekt och varje användare kunde bara rösta en gång per post eller per kommentar.</span></p>
<p><br><br></p>
<p><strong>Krav 5: Användare (optionell)</strong></p>
<p><span style="font-weight: 400;">Att bygga ett poängsystem för varje använda var en strulig procedur. Jag valde att följa uppgiftens exempel där det är en kombination av att skriva en fråga, skriva ett svar, skriva en kommentar, och poängen som man har samlat från olika kommentarer eller posts.</span></p>
<p>&nbsp;</p>
<p><span style="font-weight: 400;">Så min query helt enkelt tog alla kommentarer och posts och summerade dem där de inte var soft deleted. Sedan summerade alla poängen av alla posts och kommentarer där de inte var deleted. Samt den sista var att ta alla kommentarer som inte var deleted och där de har blivit markerad som svar och multiplicera den kommentarens poäng med två.</span></p>
<p>&nbsp;</p>
<p><span style="font-weight: 400;">På så sätt får en användare lite motivation att faktiskt skriva ett bra som som gör att andra vill gärna ge den kommentaren röster för att sedan blir markerad som svar, så får man en väldigt stor bonus med poäng.</span></p>
<p>&nbsp;</p>
<p><strong>Krav 6: Valfritt (optionell)</strong></p>
<p><span style="font-weight: 400;">För det sista kravet där man fick välja själv vad man ville arbeta med valde jag att implementera ett moderator system. Det innebär att vissa användare kommer få en grön ikon som markerar dem som moderator. Deras plikt är att hålla koll på allt innehåll och kan radera kommentarer och posts.</span></p>
<p>&nbsp;</p>
<p><span style="font-weight: 400;">Min idé när jag började projektet var att man ska kunna skriva en förfrågan i ett formulär till en admin som hanterar sidan. Som i sin tur skickar ett mail till admin. Sedan ska han kunna klicka på en länk i mailet som kommer ge den personen moderator rättigheter. En moderator skulle också kunna stänga ute folk från att skriva kommentarer eller skriva nya posts.</span></p>
<p>&nbsp;</p>
<p><span style="font-weight: 400;">Tyvärr så gjorde jag detta kravet sist och fick in bara några 10 timmar på att få allt att fungera rätt. Jag hade inte riktigt tid med att implementera allt som jag ville från början. Men jag fick in det mesta förutom att man kunna stänga ute användare. Min lösning på att få mailet att fungera skulle vara att använda en nodeJS server som kan hantera SMTP request och sedan vidarebefordra ett meddelande till ett mail. Men jag kände att det kan vara riskabelt och dra åt sig mycket tid att få allt att fungera korrekt, samt att jag hade inte gjort det innan. En stor risk.</span></p>
<p>&nbsp;</p>
<p><span style="font-weight: 400;">Så jag valde att göra det lite enklare med att användaren “admin” är en moderator automatiskt. Och han kan sedan ge moderator rättigheter till andra användare samt att någon som är moderator kan också ge moderator rättigheter till andra användare. Detta är då inte ett bra system då vem som helst kan bli moderator och kan radera posts hit och dit. Men det är mycket säkrare än att skapa en nodeJS server som hanterar allt och detta kommer fungera bättre i längden. Och jag tror att studentservern kan nog inte köra en nodeJS server iallafall.</span></p>
<p><br><br></p>
<p><span style="font-weight: 400;">Generellt om kursen tyckte jag den var okej när det kommer till svårighetsgrad. Alla krav var rimliga och inte för svåra. Jag tyckte detta var en av de mer svåra kurserna som vi har gått igenom, då jag är inte så där bra med PHP så lärde jag mig en del. Jag tror faktiskt jag lärde mig mest och SQL och kodstruktur mer än PHP. Något som inte gick bra för mig var enhets testerna, det var något jag gjorde sist och jag hade byggt mitt system ganska kopplat till databasen så det var omöjligt att köra testerna i circleCI med databasen. Så jag fick skriva några separata enhetstester som inte använde databasen. Sedan detta projektet var en av de största vi har gjort hittills. Kanske en bra förberedelse till nästa kurs som är ett grupp projekt tror jag?</span></p>
<p>&nbsp;</p>
<p><span style="font-weight: 400;">Tillsist om lite feedback om kursen. Hela idéen med anax var att introducera oss till php ramverk då anax är ett ganska enkelt och simpelt ramverk. Jag och säkert flera andra som jag har pratat med skulle gärna arbeta med ett riktigt php ramverk som laravel eller något liknande. Det känns som vi har fått hela idéen med php ramverk från tidigare kurser. Jag tror det skulle faktiskt har gjort kursen en del lättare om man bortser från enhetstester och alla config filer som finns. Anledningen varför jag tror det är att det finns en hel del dokumentation om laravel och frågor och svar om allt möjligt. Det finns en del dokumentation för anax men inte för exakt alla delar och generella frågor om hur man ska lösa ett speciellt problem. Om det fanns kanske en grundlig template github repo för alla tester och config filer för ett laravel projekt som man kan ladda ner inför projektet och börja från grunden. Jag tror vi skulle ha lärt oss mycket mer om det då laravel används i jobb marknaden jämfört med anax.</span></p>
  </div>